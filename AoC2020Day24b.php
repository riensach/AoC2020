<?php

$puzzleInput = "sewnwwwswnwnwwneneeenwwseswseww
nwwseneswnwsenwwweseneenesenwwwnw
seswewnwnesewneneneseseswwsesesesesenew
sesewnwwwswesenwswswneswswswwwnew
nwswenenwswenwnwwnwnwnw
wwswwwswwnwwe
wewnwsenwswnenwneneesenwwswsene
nenwnwnwnenwnesewnwnwnenwnene
nwewwwnwnwnwswwnw
nwnwseesewswsenesenesesewswseseseeswe
swnweseseenwseeswewneeneswewesesenw
enwneneeswneesewneneneenwnwneeese
senwswseesesesenwswseswsenwneseseseswsese
seswswnewneswswseneswsweswsw
swnwnwnwnwnenwwnwnwenwnwswnenwsenwnwnw
nenesesenenenenewenwneneneneswnewnwne
seweeeseewseseewseewwneeee
nwwwswwewwwswnwswswewswwsw
nwnwnwsesenwnenenwnwsesenwnwnwnwenwswnww
wesewsewswneneesenenenwnenwwnenwnwnw
nwnenwnenenenenenwnwsenw
wesweeswenwenweeenweswsenweew
senwswswnenwwsweneswweswwswenesew
nwwnwenesenwnwnwnenesenwsenwnenwwnwesw
newnwenenenwnenwsenwnenwnenesenenesese
seswnewnewnwswewnwswwwnenwsweeeww
nenwnenenwnwnwnenwnwnwneseswne
enwswswswenenwwswswneswse
wwsenwsewnewnwswnwsweswewwwwsw
eseeneewnwwnwneswneweeeeesee
swwneswswesenwnenwnwsenewwseseeswseene
wwswneswswswswneswswswswsewswswenesesw
nenenenenenenenenenenenwnesene
nwwnweswnwwwswenwswswwwswswwneeese
swneswnwseseseswswswweseswswswnweswewsw
weseseeswesenwseeeeseesenwesene
wswswseewnewswwneneswseneswwseswsese
wswnwneeenenenenenesenenenenenenwsenene
neneneneneswnewneeswnenwneeeenenene
swseswsewseswwsenwswneseswswseeseswsw
wswswswnesweswswswswwewnewswneseswswsw
nwsenesesesewweseseswnesewswne
sewswwnenwneneseeneesw
nwwnwnwnwswnwwnwnwwwnwne
enwsewneweeeseeeseseseeseeee
seswneewneenenewneneneneneswnweswne
seswseenesesewswswswsenwseesenwsesesw
swnwwnwnwnwnwnwwswswnwnenwenwnwenwnww
nenwnwnwwenenwswswnwnwnwnwenwnenwnwne
nwsewsenwneswsenwsenenwwnwnewswsenwe
wneenewwnwseneeseseewwseswsesese
swswneeeseesenwneesweneseesesenwsww
wnwsweswswwnwswwswswswnesewseswswnwew
swsewsesesewswneseswswswsenwneewnwe
nenenwnenwnenwsewnwnwnene
neseswswwwnwseenwswswwswwwese
enwnewwswwesenwnwnwswnwnwwwnwwnww
nesewnenwwswnweenenenwnenenene
wnwseeneseswnwnwsese
wewswsewwnenwwsenwwwnwwwwnw
wsesewsenesesewesenweseswseseseneneswse
eeswswsenwnesenewne
wseseswswswswswswswwenewnwswnwswswne
wswswswswewwwwswenwewwswnwswsw
enwnwneseswneeneswneeeeneneeswenenw
nenwewnwnenwnwnwnenwswsenwenwnwwnw
swnewseswseseseseesesesenwnwswenwsew
seewwwwwnewswwwnwwwnwnewnenwnwse
neswenweneneseeeneewneswneewneenesw
nesenwsewnwsenenenwwswnw
sesweeeneseneeneenwweenenewwsene
neneneeswnewneseswnewenenwewnenene
swneneswwwsenwnesenwnwwwnewnwnwww
nwenenwnwnwswwnwwnwnwsesenwsenwnwsenenw
seseseseseswsenwseseseseseneswnwsesewsw
nwswweswswnenewneswswswewswswswese
seeneseswseeeeesewseseenwneeswesw
seseeswswsesesewsesenwseesesesenwsese
nwsenwnenweswswenenwswesenwnesenenene
nwnwnwnwnwwsenwswnenwwnwnwnenwnwsenwsene
nenwnwwseneenwnwsw
eeeneeeeeseswe
neneesweneneseswnenwneneseneenewnwwe
wswneneneswswswseswnenewswswswswswswsw
neswswseswewswnewswswewswnwwswswenw
wwwseneweswnesesweseseswneswseese
wneeswenesenweneweneeeswnwswseene
wseneseneswnwneeneenwnenenenewnewne
nwsenewenenesewwnese
sewwnenwewwwsewswewsewwnewwww
seeeenweneswnwswseswnwnwwswswenwne
senwwwnwenwewnwnwewnwwwesenwenw
neswnewseenenewsweeesewnwenenwe
seneneswseweewnwnenwseweneneewnew
swwswnewnweseseswwwneweeneneseswwne
sesenewswswseseseseseneswwse
swsenwnenwwnenenenwnenee
sweeweenweeeswenwee
swsenwneseswewsesesewesenwsenweesw
swwsewswwswwswwwswswnwsw
eswnwneseswneneenenesw
newswsenwesewwwwwnenwswnwnwenwnwnw
seeseseenwseneenwneeesweeswewesw
seeeseswesesewsesenweeenwseeeesw
nenesenewnenewnenewwswneseseseenwnene
swwswneswswswwswwsewsw
sewesweeseeseneeeeee
seseswswswnewnwewsweseneswswsesewwsw
wnesenesweeenenenenenenwewnenenesw
nesenewwnwwneswnwnwsenwsewnw
enwwswnwwwwnwnwwnww
sewneeeseseenwnwnwseswseseseeseneese
eseseseseswneseseenenweseswseswe
swsesesenwneswswwneseeseeswwnwswswse
swnwneseseseswseseswseseseseseswnesewsw
nwswwwseesweswwswwne
sewnwnwwsewsewsenenwnwnwwnenwwnwwesw
wwwnwwnwnwswwswwnwwnewwe
seswnwenweswewnwswseneseswneewnww
seseseseseneseesesesesesenwsewsewsese
swwsesenwswnwswnwewnwnwnwnenwnwnwnwwne
senwseeeeeeseeseewsese
swswenewswswneseseswseswnwswneseswww
neneneneseneneeneneneneswneswnwenwesene
swseswseseseneesenenewewwseeswnenew
swnwnewwwwwwsewwweswwwneww
wswswnwswwwswneseswswswswwswseweswsenw
enwswnwnesenwnwenwenwswneneswnwnwnww
eneesweneneneeswnwne
wnwwewwnwwnwwwnese
nwwewneseeeswenwseswswswswsenwwswnwsw
wnwnwnwwnwnwwwwwnesew
wnwswseeswenewww
nwnwnwnwnwwnwseswneenwnenw
enesweeneseeeweenwseneswwswee
sewwwswneswnwsewswsw
neseseswneswwswswseseswneseseswseswswse
eseswswswswnwswseswswswse
eeseswnwswswseenwwseswnwseneseswsene
wwswneneswsewwneswswseswseswwwwnw
newswwsewneeneseeseseewsewnwweswse
nwnenwnwnwnenwnwnwwnwswnwnwnwnwsweenw
neneenesewnenewsenenenenwswwneenenese
neneseneneneneneneseeneneneswwnenewnene
nweswnwseswsweeeeenenenwsweseweese
swneswseswswswnwseseswswswswnwseeswwsw
wnwsenwwnwsenwwswnenwnwwnwenenewsenesw
nweseseeswsweesenweswnenweseseee
wswnenwnwnwsenwwenwnwseenwswnwnwsenwnene
nwnwnewnwnwnwnwwnwswnwnesweswsenwnwnww
neweewenenwneeeeneeseseswseenew
weweesweseneeswwseenwnwnewneee
wnesweneeeneseenwwwseenesweww
wnewseneneswswseswswwnesenwneswnewsenw
seswnwewsewswswswwnenwswsene
swswwnewswsewswweswswneseswswsw
nwewsweeneneneneswnww
newneweneneneswneneneneneneeneeseswne
nenwewnewseswnewneeswswseesenenww
seswswswneswswwswswswseneswneseneswsesww
nenenenenenwneeneseeesweneswsenwnenwww
eeneeeeeneeenesweesw
swwseneswsweswseswwseswseswneseswsenewse
seenweneeswwwwswnenenewneseneene
swswneswswswsewseseneseswweeenwwnwswsw
newnwswnewwnewwsesenwswnw
weneswswnewnwsenwswnenesenwnenenwnene
sesesesweseweswsewsewenwseesenwse
nenweenwwnwwsewnwwswnwnesenwwswsw
swnwswnwseneneseseswswseswwswsewneswswsese
nenwnenwenenesenwnenwnwswnwne
nwswswweseswswneswseew
eeswseenweeeseweseeeesee
sewwswswswseneswsweseneswswswneseswwsw
ewewnwsweeenesweeneseeswneenwe
neneswesenwnwsweeseswnwswwswnwewesw
neeneneeswenweeeeneneee
nenesesenenwnwnwnesewnwneneneswnenwnenwne
seseseneweneswwseseswsenwseseseswsese
sewsewneewewnwswwwneww
seseseseeseseswsenwsesesenwsenwseseee
sewwwwneswwesenwwwswswswww
eneeswneseweeweeewenweeene
swswnwswsweswswseseseswse
seseseswsenwswseseseeseswsesesesenwe
nenenewnenwnenwneeenenwnenwneneneswse
eseeeeeenweeeeee
wwwwnwwnewnwsewswwswneweesesew
seenewwneneneseeeneneenenenewnene
seswswneneeenwswwnwenenewnenenenesene
eeewneseeeswseenweewseewee
eeeewsweeenwnwweeseeneenenew
nwneswswnenwnenwnesenwnwwnwneswnwseswsew
nwsweeneeneseeenewnwnwneneswneswne
swsesewseseesenenew
nenesweseeeeewesweeesenwseee
nwnwenwwswsewswwneenwwnwsewseene
enwneneneswneeneneneswnenweeneswsene
swswwswswneswseswswwwswswsw
swswswswseswseneeswnewswwsesese
wseeswesenenwenenenwneeneweeswnee
eseenwseeseenwnwsweseseesesenw
sewswseseeseseseneseswsenesesewsesesw
swswnesenenwnewseewsweswneswwswswswse
sewwswseswnenwwewwswwwsewwnwswnwnw
nwnwnwenwwnwnwnwsenenwnwnw
swwnwsweswseeewnewwwnese
swwenwnwnwwswseeewnwnwwewswnenwne
seseneesenenwswnewwseesewseeswsese
swsesweeswnesewweeneswwswwswseswne
wswsewwwswnwwwnwwnenewwwseewnw
eewswnesenwswnwnewseeswnwnwnw
nwwwnewwewnwnwwnwnewwnwewswsw
sesewneswneenwseswseesese
neswweneeenesweneenesenewne
nwwnwseswswnwnwnenwnweswnwswnwwweenw
enwnenwnewenwnenenwnwwnene
neswnwnenenwnwswenenwnewse
nwweneenenewswneswnwenenesenwnewnw
neeswsewswnwnewswswswsesewnwneseswswsw
senwneswwnwnenenwnenenesenewenenenenene
sesewneswswsweenwsesweswnw
ewneesewneeeenesenweswnesesweee
swsewwwwnwwwewnenwsewwwsewwnene
swswnwseswesesweswneseswswseswswnwswnwswse
swseswswneseeseswneswenwneeswwnwswnww
weeswswnwswswswnwnwswswsweeswswswsww
nesewnwswseswwenweweseeeswnesene
sweseswnesenwseesesweneeswsesenwnesw
nwseeswseseeneswseswnwsweswseswsewse
sesewsesesweseeneenwesee
seneesewswewswnwsesw
seseseeseseseesesewseenenwnwsesesee
wneeeseseewswswseewnesenenwesenw
eneneeeneewneeenee
eneneneenenenewnenenesenwwnesw
eeeeeseeeenwe
nwnwnwnwnwenwnwnwnwwnw
seenwnenwswsenenwnenenewnenwnenenwnwnw
swenewweeeneseneneneeenweewnesw
nwnwnwnenwnenwnwnwnwse
seswswseesewswwseswneswswseenw
senewsewswnwewneswsewneenewwswsw
nenenwenwnenwswnenwnwne
nenenenenenwnenenewneneneswenene
eseneseseseswseseseseeee
wseseeneeseswseseseseenwwsewseswse
enwneeneneeneeseweeeeeewnesw
swswswswswswenwneswswwswswswneseswswe
eeeeeweneeee
wswswswnwewswswnwnweswwwswweswwse
nenenewnewseneneesweenweeneneeene
nenwneseswnwnenenewsesenenenwnesenewsenene
wswsenwswswseseswsenewneneseseseswswsese
nenwnwneenwswnwenwnwnenwnenwnwnwnewsw
nwnwwwnwwwwwneswnwwww
senweneswseeseweeseeewenewseee
eseseeeweesesesesesee
senenwnenwnewneeswneseenenwswseneneswne
nenwnenenewseneenenesesenenenewnenene
wnwnenenenewnenwwsenewseeseeswnenw
nwnwswwnesewnweewswnenwenenwnwwene
senwnenwnwnwnenwwnwnwnwwnenwesenwnwnw
seeeeeenwswswesenwnwsewesew
newwswnewsenwwwswwwenwnewwww
neneswnenwseewneneneneneneneneesenewnw
eneeesenewseneweswneeneneeenewe
seesewseeesesenwnwnwsweseseswsesesesee
enweseeeeenweseeswnwseewseeese
eswneeeeeeeenweneeeeesw
senwseseswseseeneseeseseseesewswnewe
nwnwnwenwsenwesenewnwswnwswnwnwnwnwnwnenw
neeneeenwsweeeenwsesweneneeewe
sweenenenewwneneneneenenenene
enweeeeeeneneeneneese
eneeseswsewsenwneswsweseswneeesenesw
enwwnwswnwnwwwwnwewnwwsewnwnwnw
wnwwwnwwewswnww
nenwneeswweswnesweneneeeswswewse
eswweseeseneenweneeewenwe
eswswswnweswswsweswswwswswnwsenewswnwne
swwseweneeeeweseeseesenenw
eeeeeenesweseeeeswnesweenwe
swwswneswwswwwswnewswwwewwswnw
nwneswnwswnenenwneenwnwenwnwnwnenwew
newwnwsewsewnwwweneswswnwwnwnew
neesweswswnwseswwwwwswneneswsenwwww
wswnewwwwwswneseswnwneneswwswwsew
eneswwwswnewwswswweswwwwswnwnenw
eswseneseswswsewseseswseseswseswswnwne
eeeeeeeeeeewswenenwee
sewnenenenewnwnwseeenwseswswweee
nenenenenenwseseneneneenenewneswswwnwnenw
wswswnwswnwseswseneswswswnewsweswsesw
eeewnenwneswwseseneeswseesewww
wsesweswswswswswswswswswswswnwwnwswenw
nwseswswswwswswsene
sewwwswwnwswswwnewswwnesewsesww
swwswswswswswswwswsenwne
nwnenwnwsewwnwwnwnwnwnwseww
swewseewnwenweseseneswnwenwsweesee
eeweswswneneenwesweneeeeseee
wseseseesesenewnwnesewswseseseesee
wswwnesewwnwwwnwseneswwwwew
nwwnenwwswnwweseeeswseseneenwwnwne
sewwwnwwsewwnwesesewswnwnwwnewe
newsesenwwsenesesewwneseseseseseneseesw
sweweseneseswnwswweswseswnwswnwnwsww
swsenenwnwneswnwnenwnenwnenenwnwewnw
swswwewwswsewewwwsenwwwnewwww
nenwsenwnwswnenwnenenwsenenwwnwnesenwne
seseseeeesewswnesesenweseseneewse
esesenweswseseneweeseseesesesee
wwswsewwwnewenewwwwwwnwnww
nwneseneeseeeseswnewseeswse
nwneneneeneenenese
eswseeeseesenweesesenwweewsesesese
wneweseswswnwswneneeeeene
nenewnwnenenwswsenenenesenwswneswswnenenw
sewnenwseswsesenwswnenenwnwnwnwnwwenw
nwnwnwenenwnwnwnwswnenenwnwsewnwsenwse
sesenewwnenwwnwwneswwswnwewenenwsw
neneewnwnesenwnwnenewneswnenwnenenwenw
neseenweneswnwnwneswwnwnwnwnenenenwnenw
nenenweswwneswnwnenenenweneenwswnene
swnenesenenenenenenenenwnenenwene
wneswnenwswwswseenwwwwwsew
sewwwnenewwwwwnesewwwswsewwne
nesenwneenesweeenwenene
seseeseeeswsenwseseeseseesesewsenw
nwnenwnwneneeenwswnenwswnwswneenwnwnwnenw
seneneeesweewesewwsewwnewee
nwwnenwsewnwwnwnwnwenenwnwwsewsenwnw
wswwwwwwswswsewneneewseenenwnw
nwseeswesesesesenwseenweeeeeeesw
seenewnenwswsenwnenesewnwswsenwnewnenw
wnwnewseswneeneeweenwnenweenese
swswsweenwnesenwswwneswseswwseneswse
nwesenenwnewneenwnwnwnwneswsesenwnwnenene
enenewneneneneneswewswneeneweneese
nwwwnwsenwnwwwnwwnwnenww
nwnwwnwnwnwnenwnwnwnwseswnwnwnwnew
swnewnenwneswenesenenwneewneneswnenesw
nwsewnwnwwnwswnewnenwwnwnwse
seneneswneneewnenwnenenewneswenenwsene
sweseneeeenewenenenweneenewene
enwwwwwwwnwwwsewwwswnewsene
sewewseswwsenwnwwesewewwwwnenew
nenwnwnwnwewnwsww";

//$puzzleInput = "sesenwnenenewseeswwswswwnenewsewsw
//neeenesenwnwwswnenewnwwsewnenwseswesw
//seswneswswsenwwnwse
//nwnwneseeswswnenewneswwnewseswneseene
//swweswneswnenwsewnwneneseenw
//eesenwseswswnenwswnwnwsewwnwsene
//sewnenenenesenwsewnenwwwse
//wenwwweseeeweswwwnwwe
//wsweesenenewnwwnwsenewsenwwsesesenwne
//neeswseenwwswnwswswnw
//nenwswwsewswnenenewsenwsenwnesesenew
//enewnwewneswsewnwswenweswnenwsenwsw
//sweneswneswneneenwnewenewwneswswnese
//swwesenesewenwneswnwwneseswwne
//enesenwswwswneneswsenwnewswseenwsese
//wnwnesenesenenwwnenwsewesewsesesew
//nenewswnwewswnenesenwnesewesw
//eneswnwswnwsenenwnwnwwseeswneewsenese
//neswnwewnwnwseenwseesewsenwsweewe
//wseweeenwnesenwwwswnew";


$inputArray = explode("\n",$puzzleInput);
$tileArray = array();

// . = black
// # = white

$time_pre = microtime(true);

$tileMap = new \Ds\Map([]);
$arraySizeVariable = 70;
for ($x = -$arraySizeVariable; $x < $arraySizeVariable; $x++) {
    for ($y = -$arraySizeVariable; $y < $arraySizeVariable; $y++) {
        for ($z = -$arraySizeVariable; $z < $arraySizeVariable; $z++) {
            $tileMap->put("$x:$y:$z",'#');
        }

    }
}


// Time stuff
$time_post = microtime(true);
$exec_time = $time_post - $time_pre;
echo "<br><br>Spent $exec_time seconds so far<br>\n";


//var_dump($tileArray);

// 3483 too low

foreach($inputArray as $key => $puzzleValue) {
    preg_match_all("/(se)|(sw)|(ne)|(nw)|(e)|(w)/", $puzzleValue, $directions);
    //echo "$puzzleValue<br>";
    //var_dump($directions[0]);
    $x = 0;
    $y = 0;
    $z = 0;
    foreach($directions[0] as $dirKey => $direction) {
        //echo "$direction";
        if($direction=='se') {
            $y--;
            $z++;
        } elseif($direction=='sw') {
            $x--;
            $z++;
        } elseif($direction=='ne') {
            $x++;
            $z--;
        } elseif($direction=='nw') {
            $y++;
            $z--;
        } elseif($direction=='e') {
            $x++;
            $y--;
        } elseif($direction=='w') {
            $x--;
            $y++;
        } else {
            echo "wut";
        }
    }
    // echo "Updating tile $x - $y - $z<br>";
    $tileValue = $tileMap->get("$x:$y:$z");
    if($tileValue == '#') {
        //echo "Flipping to black<br>";
        $tileMap->put("$x:$y:$z",'.');
    } else {
        // echo "Flipping to white<br>";
        $tileMap->put("$x:$y:$z",'#');
    }

}




$tileArray = $tileMap->toArray();

//var_dump($tileArray);

for($i=1;$i < 101;$i++) {
    $tileArray = $tileMap->toArray();
    foreach ($tileArray as $dimension => $tileValue) {
        //echo "$dimension<br>";
        $dimensions = explode(":", $dimension);
        $x = (int)$dimensions[0];
        $y = (int)$dimensions[1];
        $z = (int)$dimensions[2];

        $x1 = $x - 1;
        $y1 = $y + 1;
        $z1 = $z;

        $x2 = $x;
        $y2 = $y + 1;
        $z2 = $z - 1;

        $x3 = $x + 1;
        $y3 = $y;
        $z3 = $z - 1;

        $x4 = $x + 1;
        $y4 = $y - 1;
        $z4 = $z;

        $x5 = $x;
        $y5 = $y - 1;
        $z5 = $z + 1;

        $x6 = $x - 1;
        $y6 = $y;
        $z6 = $z + 1;

        $neighbour1 = isset($tileArray["$x1:$y1:$z1"]) ? $tileArray["$x1:$y1:$z1"] : '#';
        $neighbour2 = isset($tileArray["$x2:$y2:$z2"]) ? $tileArray["$x2:$y2:$z2"] : '#';
        $neighbour3 = isset($tileArray["$x3:$y3:$z3"]) ? $tileArray["$x3:$y3:$z3"] : '#';
        $neighbour4 = isset($tileArray["$x4:$y4:$z4"]) ? $tileArray["$x4:$y4:$z4"] : '#';
        $neighbour5 = isset($tileArray["$x5:$y5:$z5"]) ? $tileArray["$x5:$y5:$z5"] : '#';
        $neighbour6 = isset($tileArray["$x6:$y6:$z6"]) ? $tileArray["$x6:$y6:$z6"] : '#';

        if ($neighbour6 == '=') {
            echo "made it here!!!!<BR>";
        }

        $blackTileCount = 0;
        if ($neighbour1 == '.') $blackTileCount++;
        if ($neighbour2 == '.') $blackTileCount++;
        if ($neighbour3 == '.') $blackTileCount++;
        if ($neighbour4 == '.') $blackTileCount++;
        if ($neighbour5 == '.') $blackTileCount++;
        if ($neighbour6 == '.') $blackTileCount++;

        if ($tileValue == '.' && ($blackTileCount == 0 || $blackTileCount > 2)) {
            //echo "got here for tile $dimension :: $blackTileCount : $neighbour1 :  $neighbour2 :  $neighbour3 :  $neighbour4 :  $neighbour5 : $neighbour6<br>";
            $tileMap->put("$x:$y:$z", '#');
        }
        if ($tileValue == '#' && $blackTileCount == 2) {
            //echo "got here2 for tile $dimension :: $blackTileCount : $neighbour1 :  $neighbour2 :  $neighbour3 :  $neighbour4 :  $neighbour5 : $neighbour6<br>";
            $tileMap->put("$x:$y:$z", '.');
        }

    }
    $time_post = microtime(true);
    $exec_time = $time_post - $time_pre;
    echo "Spent $exec_time seconds so far and done iteration $i<br>\n";
}


// Time stuff
$time_post = microtime(true);
$exec_time = $time_post - $time_pre;
echo "<br><br>Spent $exec_time seconds so far<br>";


$blackTileCount = 0;

foreach($tileMap->values() as $x => $tileValue) {
    if($tileValue == '.') {
        $blackTileCount++;
    }
}

echo "Black tile count: $blackTileCount<br>";

